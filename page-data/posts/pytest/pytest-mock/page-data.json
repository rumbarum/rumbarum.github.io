{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/pytest/pytest-mock/","result":{"data":{"markdownRemark":{"id":"36dab1fe-981f-51a5-aa88-f3dfaf6814cf","html":"<h3 id=\"required\" style=\"position:relative;\"><a href=\"#required\" aria-label=\"required permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>required</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">pip <span class=\"token function\">install</span> pytest pytest-mock</code></pre></div>\n<p>pytest의 플러그인인 pytest-mock을 통해 mocking을 해보도록 하겠습니다. </p>\n<p>폴더구조와 구성은 다음 과 같습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 490px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/edcd768b8d61fab1c07f7ff893e71d3d/41d3c/pytest-mock.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.02040816326531%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABjklEQVQoz42S207CQBRF+0eKxBjsZabTAoUWSomgDRVEosZXNBH1Z3w1MST6IBhN0C/bzplpNcZLfNg5c+nZWXtOjbXREpuHC1SOFuhdPqI5fUZjukJ88Ypk9obwfIX1g+U/9IyN7BZGaX+O8nCOrfEc3bM7JOcPSK9f0L9YYnD1hP5MfjyYf1Ep+6zUrzS8Rzm9gWE5DKYSR3nLghcm6E/2YdYdWIGAHQp4HQ9uUygVay/24PguTJuBPJQYJ0MOJUaXDupRC4ODHfCAw21QsxaXYnUB3tCVzhxfKBAyMnMPwyQjKdpULAdBO8HoZA9u6MKNfIi2L2lkbfnyTK47VVXJkO5MR/cWHoaVL0jb0rAWxUjHqSThkio3ksY8kKShp/dE3NAqyD4IfzLMJj2wGgcLdFQyUgaBjl9EpzvT/sOwYtkqcnacfY3cySNKOhHrM55HVpS2fsefCcM20pEkrOeE+WCKiETLakJROlX5FwhNZ7LfCOMuxqe7EBFXRDQQGgTRFANyI09Vi7vfIr8DdxF7N3s/0r0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/edcd768b8d61fab1c07f7ff893e71d3d/8ac56/pytest-mock.webp 240w,\n/static/edcd768b8d61fab1c07f7ff893e71d3d/d3be9/pytest-mock.webp 480w,\n/static/edcd768b8d61fab1c07f7ff893e71d3d/47e4b/pytest-mock.webp 490w\"\n          sizes=\"(max-width: 490px) 100vw, 490px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/edcd768b8d61fab1c07f7ff893e71d3d/8ff5a/pytest-mock.png 240w,\n/static/edcd768b8d61fab1c07f7ff893e71d3d/e85cb/pytest-mock.png 480w,\n/static/edcd768b8d61fab1c07f7ff893e71d3d/41d3c/pytest-mock.png 490w\"\n          sizes=\"(max-width: 490px) 100vw, 490px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/edcd768b8d61fab1c07f7ff893e71d3d/41d3c/pytest-mock.png\"\n          alt=\"sample\"\n          title=\"sample\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># mocking_const.py</span>\nCONST <span class=\"token operator\">=</span> <span class=\"token number\">10000</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># mocking_export.py</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">SomethingExport</span><span class=\"token punctuation\">:</span>\n    val1 <span class=\"token operator\">=</span> <span class=\"token number\">1000</span>\n    val2 <span class=\"token operator\">=</span> <span class=\"token number\">1000</span>\n    val3 <span class=\"token operator\">=</span> <span class=\"token number\">1000</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">val</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token builtin\">sum</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>self<span class=\"token punctuation\">.</span>val1<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>val2<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>val3<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">some_export_func</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"message\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"SUCCESS\"</span><span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># mocking_import.py</span>\n<span class=\"token keyword\">from</span> example<span class=\"token punctuation\">.</span>mocking_const <span class=\"token keyword\">import</span> CONST\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">SomethingImport</span><span class=\"token punctuation\">:</span>\n    val1 <span class=\"token operator\">=</span> <span class=\"token number\">100</span>\n    val2 <span class=\"token operator\">=</span> <span class=\"token number\">200</span>\n    val3 <span class=\"token operator\">=</span> <span class=\"token number\">300</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">val</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token builtin\">sum</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>self<span class=\"token punctuation\">.</span>val1<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>val2<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>val3<span class=\"token punctuation\">,</span> CONST<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">some_import_func</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"message\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"SUCCESS\"</span><span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># mocking_import2.py</span>\n<span class=\"token keyword\">from</span> mocking_export <span class=\"token keyword\">import</span> SomethingExport<span class=\"token punctuation\">,</span> some_export_func\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">SomethingImport2</span><span class=\"token punctuation\">:</span>\n    val1 <span class=\"token operator\">=</span> <span class=\"token number\">100</span>\n    val2 <span class=\"token operator\">=</span> <span class=\"token number\">200</span>\n    val3 <span class=\"token operator\">=</span> <span class=\"token number\">300</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">val</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token builtin\">sum</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>self<span class=\"token punctuation\">.</span>val1<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>val2<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>val3<span class=\"token punctuation\">,</span> SomethingExport<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>val<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">func</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> some_export_func<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># mocking_tests.py</span>\n<span class=\"token keyword\">import</span> pytest\n\n<span class=\"token keyword\">from</span> example<span class=\"token punctuation\">.</span>mocking_import <span class=\"token keyword\">import</span> SomethingImport\n<span class=\"token keyword\">from</span> example<span class=\"token punctuation\">.</span>mocking_import2 <span class=\"token keyword\">import</span> SomethingImport2\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Something</span><span class=\"token punctuation\">:</span>\n    val1 <span class=\"token operator\">=</span> <span class=\"token number\">100</span>\n    val2 <span class=\"token operator\">=</span> <span class=\"token number\">200</span>\n    val3 <span class=\"token operator\">=</span> <span class=\"token number\">300</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">val</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token builtin\">sum</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>self<span class=\"token punctuation\">.</span>val1<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>val2<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>val3<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">some_func</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"message\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"SUCCESS\"</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">TestMockingClass</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"pytest-mock 라이브러리 mocker fixture 예시입니다.\"\"\"</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">test_patch_direct_func</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> mocker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"\n        직접 함수 리턴 값을 조작할 경우에는 MagicMock 객체를 활용합니다.\n        .return_value를 통해 ()으로 호출시 return할 값을 지정할 수 있습니다.\n        \"\"\"</span>\n        some_func <span class=\"token operator\">=</span> mocker<span class=\"token punctuation\">.</span>MagicMock<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        some_func<span class=\"token punctuation\">.</span>return_value <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"message\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"patched\"</span><span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">assert</span> some_func<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"message\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"patched\"</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">test_patch_direct_func2</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> mocker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"\n        MagicMock 초기화시에 return_values를 kwargs로 입력해도 됩니다.\n        \"\"\"</span>\n        some_func <span class=\"token operator\">=</span> mocker<span class=\"token punctuation\">.</span>MagicMock<span class=\"token punctuation\">(</span>return_value<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"message\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"patched\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">assert</span> some_func<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"message\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"patched\"</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">test_patch_imported_func</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> mocker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"\n        tests.py 모듈 밖에서의 동작에 관여하려면, mocker.patch()를 사용합니다.\n        ()으로 호출시 return할 값을 지정할 수 있습니다\n        patch는 해당 라인 동작시에 동작합니다.\n        _tests.py 모듈에 먼저 import 되어 있을경우 patch 동작이 기대한대로 동작하지 않습니다.\n        patch() 후 import 하여야 합니다.\n        \"\"\"</span>\n        mocker<span class=\"token punctuation\">.</span>patch<span class=\"token punctuation\">(</span><span class=\"token string\">\"example.mocking_import.some_import_func\"</span><span class=\"token punctuation\">,</span> return_value<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"message\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"patched\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">from</span> example<span class=\"token punctuation\">.</span>mocking_import <span class=\"token keyword\">import</span> some_import_func\n\n        <span class=\"token keyword\">assert</span> some_import_func<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"message\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"patched\"</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">test_patch_func_hook</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> mocker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"\n        tests.py 모듈 밖에서의 동작을 mocking 하려면, mocker.patch()를 사용합니다.\n        ()으로 호출시 return할 값을 지정할 수 있습니다 return_value=&lt;value>\n        B.py 모듈에서 A.py module의 func_a 함수를 가져다 사용할경우, \n        func_a 함수를 임포트한 B.py 모듈에서 patch 해야 합니다.\n        단, \n        from A import func_a 가 아니라\n        import A \n        A.func_a \n        로 사용한 경우에는, A를 patch 해야 합니다.\n        \"\"\"</span>\n        mocker<span class=\"token punctuation\">.</span>patch<span class=\"token punctuation\">(</span><span class=\"token string\">\"example.mocking_import2.some_export_func\"</span><span class=\"token punctuation\">,</span> return_value<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"message\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"patched\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">from</span> example<span class=\"token punctuation\">.</span>mocking_import2 <span class=\"token keyword\">import</span> SomethingImport2\n\n        <span class=\"token keyword\">assert</span> SomethingImport2<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>func<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"message\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"patched\"</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">test_patch_objcect_class_method_and_attr_direct_reference</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> mocker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\" _tests.py 에 정의된 Something.val patch.object를 이용해 mocking 합니다.\"\"\"</span>\n\n        <span class=\"token comment\"># patch가 아닌, patch.object 를 사용합니다.</span>\n        mocker<span class=\"token punctuation\">.</span>patch<span class=\"token punctuation\">.</span><span class=\"token builtin\">object</span><span class=\"token punctuation\">(</span>Something<span class=\"token punctuation\">,</span> <span class=\"token string\">\"val\"</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\"># some 은 Something의 instance 입니다.</span>\n        some <span class=\"token operator\">=</span> Something<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\"># some.val 은 Mock 객체입니다.</span>\n        <span class=\"token comment\"># some.val.return_value 를 통해서 값을 지정할 수 있습니다.</span>\n        <span class=\"token comment\"># mocker.patch.object(Something, \"val\", return_value=9999) 도 동일한 결과를 만듭니다.</span>\n        some<span class=\"token punctuation\">.</span>val<span class=\"token punctuation\">.</span>return_value <span class=\"token operator\">=</span> <span class=\"token number\">9999</span>\n\n        <span class=\"token keyword\">assert</span> some<span class=\"token punctuation\">.</span>val<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">9999</span>\n        <span class=\"token keyword\">assert</span> <span class=\"token builtin\">isinstance</span><span class=\"token punctuation\">(</span>some<span class=\"token punctuation\">,</span> Something<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># mock 객체가 호출되었는지 assert 합니다.</span>\n        some<span class=\"token punctuation\">.</span>val<span class=\"token punctuation\">.</span>assert_called<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\"># mock 객체가 지정한 인자들과 호출되었는지 assert 합니다.</span>\n        some<span class=\"token punctuation\">.</span>val<span class=\"token punctuation\">.</span>assert_called_once_with<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">test_patch_objcect_instance_attr_direct_reference</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> mocker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\" _tests.py 에 정의된 Something.val3 patch.object를 이용해 mocking 합니다.\"\"\"</span>\n\n        <span class=\"token comment\"># patch.object(class, attr_name, val) 을 쓸 경우, </span>\n\t\t\t\t<span class=\"token comment\"># instance.attr_val == val 입니다.</span>\n        mocker<span class=\"token punctuation\">.</span>patch<span class=\"token punctuation\">.</span><span class=\"token builtin\">object</span><span class=\"token punctuation\">(</span>Something<span class=\"token punctuation\">,</span> <span class=\"token string\">\"val3\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">)</span>\n        some <span class=\"token operator\">=</span> Something<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">assert</span> some<span class=\"token punctuation\">.</span>val3 <span class=\"token operator\">==</span> <span class=\"token number\">100000</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">test_patch_object_const_direct</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> mocker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\" 외부 모듈에 에 정의된 CONST 를 mocking 합니다.\"\"\"</span>\n\n        <span class=\"token comment\">#  SomthingImport가 사용하는 mocking_import의 CONST를 현재 모듈에서 patch.object() 로 20000 으로  patch 합니다.</span>\n        <span class=\"token keyword\">import</span> example<span class=\"token punctuation\">.</span>mocking_import <span class=\"token keyword\">as</span> mi\n\n        mocker<span class=\"token punctuation\">.</span>patch<span class=\"token punctuation\">.</span><span class=\"token builtin\">object</span><span class=\"token punctuation\">(</span>mi<span class=\"token punctuation\">,</span> <span class=\"token string\">\"CONST\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20000</span><span class=\"token punctuation\">)</span>\n        some <span class=\"token operator\">=</span> SomethingImport<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">assert</span> some<span class=\"token punctuation\">.</span>val<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">20600</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">test_patch_const_hook</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> mocker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\">#  SomthingImport가 정의된 module에서 CONST를 patch() 로 20000 으로 patch 합니다.</span>\n        mocker<span class=\"token punctuation\">.</span>patch<span class=\"token punctuation\">(</span><span class=\"token string\">\"example.mocking_import.CONST\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20000</span><span class=\"token punctuation\">)</span>\n        some <span class=\"token operator\">=</span> SomethingImport<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">assert</span> some<span class=\"token punctuation\">.</span>val<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">20600</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">test_patch_object_with_direct_import</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> mocker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"import 한 SomethingImport.val이 mock 객체를 반환하도록 patch 합니다. \"\"\"</span>\n        mocker<span class=\"token punctuation\">.</span>patch<span class=\"token punctuation\">.</span><span class=\"token builtin\">object</span><span class=\"token punctuation\">(</span>SomethingImport<span class=\"token punctuation\">,</span> <span class=\"token string\">\"val\"</span><span class=\"token punctuation\">,</span> return_value<span class=\"token operator\">=</span><span class=\"token number\">30600</span><span class=\"token punctuation\">)</span>\n        some_mocked <span class=\"token operator\">=</span> SomethingImport<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">assert</span> some_mocked<span class=\"token punctuation\">.</span>val<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">30600</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">test_patch_with_direct_import</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> mocker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"\n        mocker.patch를 사용하여 import 한 SomethingImport patch\n        \"\"\"</span>\n        mocker<span class=\"token punctuation\">.</span>patch<span class=\"token punctuation\">(</span><span class=\"token string\">\"example.mocking_import.SomethingImport\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># patch를 걸고, SomthingImport를 import 해야 합니다.</span>\n        <span class=\"token comment\"># 해당 모듈레벨에서 SomthingImport를 import 하고 있다면</span>\n        <span class=\"token comment\"># 이름을 다르게 하지 않으면 모듈 레벨에서 Import 한 SomethingImport(Not Mock)를 호출한다.</span>\n        <span class=\"token keyword\">from</span> example<span class=\"token punctuation\">.</span>mocking_import <span class=\"token keyword\">import</span> SomethingImport <span class=\"token keyword\">as</span> SI\n\n        instance <span class=\"token operator\">=</span> SI<span class=\"token punctuation\">.</span>return_value\n        instance<span class=\"token punctuation\">.</span>val<span class=\"token punctuation\">.</span>return_value <span class=\"token operator\">=</span> <span class=\"token number\">30600</span>\n        some_mocked <span class=\"token operator\">=</span> SI<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">assert</span> some_mocked<span class=\"token punctuation\">.</span>val<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">30600</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">test_patch_other_module_hook</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> mocker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token string\">\"SomethingExport가 정의된 module이 아닌, SomethingExport를 사용하는 module에서 원하는 값이 나오도록 patch 한다. \"</span>\n        \n        <span class=\"token comment\"># mock 객체가 리턴할 값을 mock 객체로 지정합니다.</span>\n        mocked_something_export <span class=\"token operator\">=</span> mocker<span class=\"token punctuation\">.</span>patch<span class=\"token punctuation\">(</span><span class=\"token string\">\"example.mocking_import2.SomethingExport\"</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\"># mock 객체가 리턴할 값을 지정합니다.</span>\n        instance <span class=\"token operator\">=</span> mocked_something_export<span class=\"token punctuation\">.</span>return_value\n        <span class=\"token comment\"># mock 객체의 val method가 리턴할 값을 지정합니다.</span>\n        instance<span class=\"token punctuation\">.</span>val<span class=\"token punctuation\">.</span>return_value <span class=\"token operator\">=</span> <span class=\"token number\">6000</span>\n\n        <span class=\"token comment\"># patch 한 SomethingExport를 사용하는 SomethingImport2를 초기화합니다.</span>\n        something_import2 <span class=\"token operator\">=</span> SomethingImport2<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">assert</span> something_import2<span class=\"token punctuation\">.</span>val<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">6600</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">test_side_effect</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> mocker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"\n        단순 값의 return이 아닌, 원하는 함수 동작을 지정할 수 도 있습니다.\n        Mock(side_effect=&lt;func>) 와 동일합니다.\n        Exception('Boom!')\n        \"\"\"</span>\n        <span class=\"token keyword\">def</span> <span class=\"token function\">_side_1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token string\">\"SIDE_WORKING\"</span>\n        \n        <span class=\"token keyword\">def</span> <span class=\"token function\">_side_2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">raise</span> Exception<span class=\"token punctuation\">(</span><span class=\"token string\">\"Error\"</span><span class=\"token punctuation\">)</span>\t\n        \n        <span class=\"token comment\"># Something의 instance.val 이 _side_1을 call 하도록 만든다</span>\n        mocker<span class=\"token punctuation\">.</span>patch<span class=\"token punctuation\">.</span><span class=\"token builtin\">object</span><span class=\"token punctuation\">(</span>Something<span class=\"token punctuation\">,</span> <span class=\"token string\">\"val\"</span><span class=\"token punctuation\">,</span> side_effect<span class=\"token operator\">=</span>_side_1<span class=\"token punctuation\">)</span>\n        some <span class=\"token operator\">=</span> Something<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">assert</span> some<span class=\"token punctuation\">.</span>val<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"SIDE_WORKING\"</span>\n\n        <span class=\"token comment\"># Something의 instance.val 이 _side_2(raise Exception)을 하도록 만든다</span>\n        mocker<span class=\"token punctuation\">.</span>patch<span class=\"token punctuation\">.</span><span class=\"token builtin\">object</span><span class=\"token punctuation\">(</span>Something<span class=\"token punctuation\">,</span> <span class=\"token string\">\"val\"</span><span class=\"token punctuation\">,</span> side_effect<span class=\"token operator\">=</span>_side_2<span class=\"token punctuation\">)</span>\n        some2 <span class=\"token operator\">=</span> Something<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># pytest raise 처리</span>\n        <span class=\"token keyword\">with</span> pytest<span class=\"token punctuation\">.</span>raises<span class=\"token punctuation\">(</span>Exception<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            some2<span class=\"token punctuation\">.</span>val<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>","fields":{"slug":"/posts/pytest/pytest-mock/","tagSlugs":["/tag/python/","/tag/pytest/","/tag/mock/"]},"frontmatter":{"date":"2021-11-17T01:23:45.678Z","description":"pytest plugin 중 하나인 pytest-mock의 샘플들","tags":["python","pytest","mock"],"title":"pytest-mock sample들"}}},"pageContext":{"slug":"/posts/pytest/pytest-mock/"}}}